{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Page</title>
    <link rel="stylesheet" href="{% static 'css/base/nav_bar.css' %}">
    <link rel="stylesheet" href="{% static 'css/base/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/categories/all_events_page.css' %}">
</head>
<body>
    {% include 'base/nav_bar.html' %}

    <section class="upper-section">
        <h2>Explore Events</h2>

        <div class="more-info">
            <p>Explore whoâ€™s hosting local and online events for all the things you love. Find out about passionate individuals and organizations creating opportunities for you to get involved.</p>
        </div>
    </section>


    <main>

        <section class="search-events-bar-section">
            <input type="text" placeholder="Search events by title..." class="search-events-input">
        </section>

        <section class="aside-and-right-content">
            <aside>
                <div class="filters-title-box">
                    <img src="{% static 'images/filters_icon.png' %}" alt="filters-icon">
                    <h2>Filters</h2>
                </div>

                <form action="{% url 'all-events-page' %}" method="GET">
                    {{ filter_form }}
    {##}
    {#                <section class="city">#}
    {#                    <h6>City</h6>#}
    {##}
    {#                    <ul>#}
    {#                        {% for city_dict in cities %}#}
    {#                            <li>#}
    {#                                <input type="checkbox" id="{{ city_dict.city }}" name="city" value="{{ city_dict.city }}" />#}
    {#                                <label for="{{ city_dict.city }}">{{ city_dict.city }} ({{ city_dict.cities_count }})</label>#}
    {#                            </li>#}
    {#                        {% endfor %}#}
    {#                    </ul>#}
    {#                </section>#}

                    <button>Filter</button>
                </form>
            </aside>

            <div class="right">
                <h2>Events</h2>

                <div class="all-events">
                    {% for event in all_events %}
                        <a href="{% url 'event-page' categoryId=event.category.id pk=event.id %}" class="event-container">
                            <p>{{ event.time }}</p>

                            <div class="title-and-img">
                                <div class="title-container">
                                    <h6>{{ event.title }}</h6>
                                    <div class="location">
                                        <img src="{% static 'images/location_grey.png' %}" alt="locations">
                                        <p>{{ event.exact_location }}</p>
                                    </div>

                                    {% if event.host.id == request.user.id %}
                                        <div class="your-event-container">
                                            <p>Your event</p>
                                            <img src="{% static 'images/your_event_icon.png' %}" alt="your-event-icon" >
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="container-event-img">
                                    <img src="{{ event.poster_image.url }}" alt="category-img">
                                </div>
                            </div>

                            <p class="details">{{ event.details }}</p>
                        </a>
                    {% empty %}
                        <h3>No events yet</h3>
                    {% endfor %}
                </div>
            </div>
        </section>

    </main>

    {% include 'base/footer.html' %}

</body>

    <script>
        const headerElement = document.getElementsByTagName('header')[0]
        const searchInput = document.getElementsByTagName('input')[0]

        document.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                headerElement.style.backgroundColor = 'rgba(67, 79, 98, 0.76)'
                searchInput.className += ' white-placeholder'
            } else {
                headerElement.style.backgroundColor = 'transparent'
                searchInput.className = 'search-bar'
            }
        })






        const searchEventsInput = document.getElementsByClassName('search-events-input')[0]

        searchEventsInput.addEventListener('input', () => {
            const eventsUrl = `{% url 'list-events-api' %}?searchedTitle=${searchEventsInput.value}`
            const allEventsElement = document.getElementsByClassName('all-events')[0]

            const response = fetch(eventsUrl)
                .then((response) => response.json())
                .then((resultEvents) => {

                    allEventsElement.innerHTML = ''

                    if (resultEvents.length == 0) {
                        allEventsElement.innerHTML = `
                            <h3>No events matched</h3>
                        `
                    }

                    for (let event of resultEvents) {
                        const aEventElement = document.createElement('a')
                        aEventElement.href = `{% url 'event-page' categoryId='00' pk='000' %}`.replace('00', event.category).replace('000', event.id)
                        aEventElement.className = 'event-container'
                        const requestUserId = '{{ request.user.id }}'

                        if (requestUserId == `${event.host}`) {
                            aEventElement.innerHTML = `
                                <p>${event.time}</p>

                                <div class="title-and-img">
                                    <div class="title-container">
                                        <h6>${event.title}</h6>
                                        <div class="location">
                                            <img src="{% static 'images/location_grey.png' %}" alt="locations">
                                            <p>${event.exact_location}</p>
                                        </div>

                                        <div class="your-event-container">
                                            <p>Your event</p>
                                            <img src="{% static 'images/your_event_icon.png' %}" alt="your-event-icon" >
                                        </div>
                                    </div>

                                    <div class="container-event-img">
                                        <img src="${event.poster_image_full_url}" alt="category-img">
                                    </div>
                                </div>

                                <p class="details">${event.details}</p>
                            `
                        } else {
                            aEventElement.innerHTML = `
                                <p>${event.event_time_formatted}</p>

                                <div class="title-and-img">
                                    <div class="title-container">
                                        <h6>${event.title}</h6>
                                        <div class="location">
                                            <img src="{% static 'images/location_grey.png' %}" alt="locations">
                                            <p>${event.exact_location}</p>
                                        </div>
                                    </div>

                                    <div class="container-event-img">
                                        <img src="${event.poster_image_full_url}" alt="category-img">
                                    </div>
                                </div>

                                <p class="details">${event.details}</p>
                            `
                        }


                        allEventsElement.appendChild(aEventElement)
                    }

                })
        })
    </script>

</html>